<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="Notice Period Tracker - Calculate your notice period end date with timezone support, calendar export, and URL sharing.">
  <title>Notice Period Tracker</title>

  <!-- Preconnect for performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- Inter Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root {
      --color-primary: #2563eb;
      --color-primary-hover: #1d4ed8;
      --color-primary-light: #dbeafe;
      --color-primary-subtle: #eff6ff;
      --color-success: #059669;
      --color-success-light: #d1fae5;
      --color-warning: #d97706;
      --color-warning-light: #fef3c7;
      --color-danger: #dc2626;
      --color-danger-light: #fee2e2;
      --color-gray-50: #f9fafb;
      --color-gray-100: #f3f4f6;
      --color-gray-200: #e5e7eb;
      --color-gray-300: #d1d5db;
      --color-gray-400: #9ca3af;
      --color-gray-500: #6b7280;
      --color-gray-600: #4b5563;
      --color-gray-700: #374151;
      --color-gray-800: #1f2937;
      --color-gray-900: #111827;
      --color-white: #ffffff;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;
      --transition-fast: 150ms ease;
      --transition-normal: 200ms ease;
      --transition-slow: 300ms ease;
    }

    * {
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, var(--color-gray-50) 0%, var(--color-primary-subtle) 100%);
      min-height: 100vh;
      color: var(--color-gray-800);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Main Container */
    .app-container {
      max-width: 720px;
      margin: 0 auto;
      padding: 1.5rem 1rem 3rem;
    }

    @media (min-width: 768px) {
      .app-container {
        padding: 2.5rem 1.5rem 4rem;
      }
    }

    /* Header */
    .app-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .app-title {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--color-gray-900);
      margin-bottom: 0.5rem;
      letter-spacing: -0.025em;
    }

    @media (min-width: 768px) {
      .app-title {
        font-size: 2.25rem;
      }
    }

    .app-subtitle {
      font-size: 0.875rem;
      color: var(--color-gray-500);
      max-width: 28rem;
      margin: 0 auto;
      line-height: 1.5;
    }

    /* Cards */
    .card-section {
      background: var(--color-white);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-md);
      padding: 1.5rem;
      margin-bottom: 1.25rem;
      border: 1px solid var(--color-gray-100);
      transition: box-shadow var(--transition-normal);
    }

    .card-section:hover {
      box-shadow: var(--shadow-lg);
    }

    @media (min-width: 768px) {
      .card-section {
        padding: 2rem;
      }
    }

    /* Section Labels */
    .section-label {
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--color-gray-500);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .section-label i {
      font-size: 0.875rem;
      color: var(--color-primary);
    }

    /* Notice Period Toggle Group */
    .period-toggle-group {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .period-toggle {
      flex: 1;
      padding: 0.75rem 1rem;
      border: 2px solid var(--color-gray-200);
      background: var(--color-white);
      border-radius: var(--radius-md);
      font-size: 1rem;
      font-weight: 600;
      color: var(--color-gray-600);
      cursor: pointer;
      transition: all var(--transition-fast);
      text-align: center;
    }

    .period-toggle:hover {
      border-color: var(--color-primary-light);
      background: var(--color-primary-subtle);
    }

    .period-toggle:focus-visible {
      outline: 2px solid var(--color-primary);
      outline-offset: 2px;
    }

    .period-toggle.active {
      border-color: var(--color-primary);
      background: var(--color-primary);
      color: var(--color-white);
    }

    .period-toggle span {
      display: block;
      font-size: 0.6875rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.025em;
      opacity: 0.7;
      margin-top: 0.125rem;
    }

    /* Form Controls */
    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-label-custom {
      display: block;
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--color-gray-700);
      margin-bottom: 0.5rem;
    }

    .input-wrapper {
      position: relative;
    }

    .input-wrapper i {
      position: absolute;
      left: 0.875rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--color-gray-400);
      font-size: 1rem;
      pointer-events: none;
      z-index: 1;
    }

    .form-control-custom {
      width: 100%;
      padding: 0.75rem 0.875rem 0.75rem 2.5rem;
      border: 1.5px solid var(--color-gray-200);
      border-radius: var(--radius-md);
      font-size: 0.9375rem;
      font-family: inherit;
      color: var(--color-gray-800);
      background: var(--color-white);
      transition: all var(--transition-fast);
    }

    .form-control-custom:hover {
      border-color: var(--color-gray-300);
    }

    .form-control-custom:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px var(--color-primary-light);
    }

    .form-control-custom::placeholder {
      color: var(--color-gray-400);
    }

    /* Select styling */
    select.form-control-custom {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3E%3Cpath fill='%236b7280' d='M4.646 5.646a.5.5 0 0 1 .708 0L8 8.293l2.646-2.647a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.75rem center;
      padding-right: 2.5rem;
      cursor: pointer;
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.625rem;
      margin-top: 0.5rem;
    }

    .btn-custom {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.6875rem 1rem;
      border-radius: var(--radius-md);
      font-size: 0.8125rem;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: all var(--transition-fast);
      border: none;
      white-space: nowrap;
    }

    .btn-custom:focus-visible {
      outline: 2px solid var(--color-primary);
      outline-offset: 2px;
    }

    .btn-custom:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-primary {
      background: var(--color-primary);
      color: var(--color-white);
      flex: 1;
      min-width: 120px;
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--color-primary-hover);
      transform: translateY(-1px);
    }

    .btn-primary:active:not(:disabled) {
      transform: translateY(0);
    }

    .btn-secondary {
      background: var(--color-gray-100);
      color: var(--color-gray-700);
      border: 1px solid var(--color-gray-200);
    }

    .btn-secondary:hover:not(:disabled) {
      background: var(--color-gray-200);
    }

    .btn-outline {
      background: transparent;
      color: var(--color-gray-600);
      border: 1.5px solid var(--color-gray-200);
    }

    .btn-outline:hover:not(:disabled) {
      background: var(--color-gray-50);
      border-color: var(--color-gray-300);
    }

    .btn-danger {
      background: var(--color-danger-light);
      color: var(--color-danger);
    }

    .btn-danger:hover:not(:disabled) {
      background: var(--color-danger);
      color: var(--color-white);
    }

    .btn-icon {
      padding: 0.6875rem;
      min-width: auto;
    }

    /* Results Section */
    .results-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    @media (min-width: 576px) {
      .results-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    .result-card {
      background: var(--color-gray-50);
      border-radius: var(--radius-lg);
      padding: 1rem;
      text-align: center;
      border: 1px solid var(--color-gray-100);
      transition: all var(--transition-normal);
    }

    .result-card:hover {
      background: var(--color-white);
      border-color: var(--color-gray-200);
    }

    .result-card.highlight {
      background: var(--color-primary-subtle);
      border-color: var(--color-primary-light);
    }

    .result-card.success {
      background: var(--color-success-light);
      border-color: transparent;
    }

    .result-card.warning {
      background: var(--color-warning-light);
      border-color: transparent;
    }

    .result-card.span-2 {
      grid-column: span 2;
    }

    @media (min-width: 576px) {
      .result-card.span-2 {
        grid-column: span 1;
      }
    }

    .result-label {
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--color-gray-500);
      margin-bottom: 0.375rem;
    }

    .result-value {
      font-size: 1.375rem;
      font-weight: 700;
      color: var(--color-gray-900);
      line-height: 1.2;
    }

    .result-value.large {
      font-size: 2rem;
    }

    .result-sub {
      font-size: 0.75rem;
      color: var(--color-gray-500);
      margin-top: 0.25rem;
    }

    /* Progress Section */
    .progress-section {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--color-gray-100);
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .progress-label {
      font-size: 0.8125rem;
      font-weight: 600;
      color: var(--color-gray-700);
    }

    .progress-value {
      font-size: 0.875rem;
      font-weight: 700;
      color: var(--color-primary);
    }

    .progress-bar-container {
      height: 0.625rem;
      background: var(--color-gray-200);
      border-radius: 9999px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--color-primary) 0%, #3b82f6 100%);
      border-radius: 9999px;
      transition: width var(--transition-slow);
      min-width: 0;
    }

    .progress-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px dashed var(--color-gray-200);
    }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      font-size: 0.8125rem;
      color: var(--color-gray-600);
    }

    .meta-item i {
      color: var(--color-gray-400);
      font-size: 0.875rem;
    }

    .meta-item strong {
      font-weight: 600;
      color: var(--color-gray-800);
    }

    /* Date Range Display */
    .date-range {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-top: 1.5rem;
      padding: 1rem;
      background: var(--color-gray-50);
      border-radius: var(--radius-lg);
      border: 1px solid var(--color-gray-100);
    }

    @media (max-width: 575px) {
      .date-range {
        flex-direction: column;
        text-align: center;
      }
    }

    .date-point {
      flex: 1;
    }

    .date-point-label {
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--color-gray-500);
      margin-bottom: 0.25rem;
    }

    .date-point-value {
      font-size: 0.9375rem;
      font-weight: 600;
      color: var(--color-gray-800);
    }

    .date-connector {
      display: flex;
      align-items: center;
      color: var(--color-gray-300);
    }

    .date-connector i {
      font-size: 1.25rem;
    }

    @media (max-width: 575px) {
      .date-connector i {
        transform: rotate(90deg);
      }
    }

    /* Info Box */
    .info-box {
      display: flex;
      gap: 0.75rem;
      padding: 1rem;
      background: var(--color-primary-subtle);
      border-radius: var(--radius-md);
      border-left: 3px solid var(--color-primary);
    }

    .info-box i {
      color: var(--color-primary);
      font-size: 1rem;
      flex-shrink: 0;
      margin-top: 0.125rem;
    }

    .info-box p {
      font-size: 0.8125rem;
      color: var(--color-gray-700);
      margin: 0;
      line-height: 1.6;
    }

    /* Toast Notification */
    .toast-container {
      position: fixed;
      bottom: 1.5rem;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1050;
      pointer-events: none;
    }

    .toast-notification {
      display: flex;
      align-items: center;
      gap: 0.625rem;
      padding: 0.875rem 1.25rem;
      background: var(--color-gray-900);
      color: var(--color-white);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-xl);
      font-size: 0.875rem;
      font-weight: 500;
      opacity: 0;
      transform: translateY(1rem);
      transition: all var(--transition-normal);
      pointer-events: auto;
    }

    .toast-notification.show {
      opacity: 1;
      transform: translateY(0);
    }

    .toast-notification i {
      font-size: 1rem;
    }

    .toast-notification.success {
      background: var(--color-success);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 2rem 1rem;
      color: var(--color-gray-400);
    }

    .empty-state i {
      font-size: 2.5rem;
      margin-bottom: 0.75rem;
      opacity: 0.5;
    }

    .empty-state p {
      font-size: 0.875rem;
      margin: 0;
    }

    /* Footer */
    .app-footer {
      text-align: center;
      padding-top: 1rem;
      font-size: 0.75rem;
      color: var(--color-gray-400);
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(0.5rem);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-in {
      animation: fadeIn var(--transition-normal) ease-out forwards;
    }

    /* Screen reader only */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Focus visible for accessibility */
    :focus-visible {
      outline: 2px solid var(--color-primary);
      outline-offset: 2px;
    }

    /* URL Display */
    .url-display {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.625rem 0.875rem;
      background: var(--color-gray-50);
      border-radius: var(--radius-md);
      border: 1px solid var(--color-gray-200);
      margin-top: 1rem;
    }

    .url-display input {
      flex: 1;
      border: none;
      background: transparent;
      font-size: 0.8125rem;
      font-family: monospace;
      color: var(--color-gray-600);
      min-width: 0;
    }

    .url-display input:focus {
      outline: none;
    }

    .url-display button {
      flex-shrink: 0;
    }

    /* Hide initially */
    .results-container.hidden {
      display: none;
    }
  </style>
</head>

<body>
  <main class="app-container" role="main">
    <!-- Header -->
    <header class="app-header">
      <h1 class="app-title">Notice Period Tracker</h1>
      <p class="app-subtitle">Inclusive — Day 1 = Resignation Date. Global timezone aware. Calendar export. URL share.
      </p>
    </header>

    <!-- Input Section -->
    <section class="card-section" aria-labelledby="input-section-label">
      <div class="section-label" id="input-section-label">
        <i class="bi bi-calendar-event" aria-hidden="true"></i>
        Notice Period
      </div>

      <!-- Period Toggle -->
      <div class="period-toggle-group" role="group" aria-label="Select notice period duration">
        <button type="button" class="period-toggle" data-days="30" aria-pressed="false">
          30
          <span>Days</span>
        </button>
        <button type="button" class="period-toggle" data-days="60" aria-pressed="false">
          60
          <span>Days</span>
        </button>
        <button type="button" class="period-toggle active" data-days="90" aria-pressed="true">
          90
          <span>Days</span>
        </button>
      </div>

      <!-- Date Input -->
      <div class="form-group">
        <label for="resignation-date" class="form-label-custom">Resignation Date</label>
        <div class="input-wrapper">
          <i class="bi bi-calendar3" aria-hidden="true"></i>
          <input type="date" id="resignation-date" class="form-control-custom" aria-describedby="date-help" required
            value="2025-10-17">
        </div>
        <span id="date-help" class="sr-only">Select the date you submitted your resignation</span>
      </div>

      <!-- Timezone Select -->
      <div class="form-group">
        <label for="timezone-select" class="form-label-custom">Timezone</label>
        <div class="input-wrapper">
          <i class="bi bi-globe" aria-hidden="true"></i>
          <select id="timezone-select" class="form-control-custom" aria-describedby="tz-help">
            <!-- Populated by JavaScript -->
          </select>
        </div>
        <span id="tz-help" class="sr-only">Select your local timezone for accurate calculations</span>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button type="button" id="btn-calculate" class="btn-custom btn-primary"
          aria-label="Calculate notice period end date">
          <i class="bi bi-calculator" aria-hidden="true"></i>
          Calculate
        </button>
        <button type="button" id="btn-ics" class="btn-custom btn-secondary" disabled
          aria-label="Download calendar file">
          <i class="bi bi-download" aria-hidden="true"></i>
          Copy .ics
        </button>
        <button type="button" id="btn-gcal" class="btn-custom btn-secondary" disabled
          aria-label="Add to Google Calendar">
          <i class="bi bi-google" aria-hidden="true"></i>
          Google Cal
        </button>
        <button type="button" id="btn-share" class="btn-custom btn-outline" disabled aria-label="Share calculation URL">
          <i class="bi bi-share" aria-hidden="true"></i>
          Share
        </button>
        <button type="button" id="btn-reset" class="btn-custom btn-danger btn-icon" aria-label="Reset all fields">
          <i class="bi bi-arrow-counterclockwise" aria-hidden="true"></i>
        </button>
      </div>
    </section>

    <!-- Results Section -->
    <section class="card-section results-container hidden" aria-labelledby="results-section-label" aria-live="polite">
      <div class="section-label" id="results-section-label">
        <i class="bi bi-graph-up" aria-hidden="true"></i>
        Status Overview
      </div>

      <div class="results-grid">
        <!-- Today -->
        <div class="result-card">
          <div class="result-label">Today</div>
          <div class="result-value" id="result-today">—</div>
          <div class="result-sub" id="result-today-date">—</div>
        </div>

        <!-- Inclusive Day -->
        <div class="result-card highlight">
          <div class="result-label">Inclusive Day #</div>
          <div class="result-value large" id="result-day-number">—</div>
          <div class="result-sub">Day 1 = Resignation Date</div>
        </div>

        <!-- Days Completed -->
        <div class="result-card">
          <div class="result-label">Days Completed</div>
          <div class="result-value" id="result-completed">—</div>
          <div class="result-sub" id="result-completed-of">of —</div>
        </div>

        <!-- Days Remaining -->
        <div class="result-card success" id="remaining-card">
          <div class="result-label">Days Remaining</div>
          <div class="result-value large" id="result-remaining">—</div>
          <div class="result-sub" id="result-remaining-sub">—</div>
        </div>

        <!-- Start Date -->
        <div class="result-card">
          <div class="result-label">Start (Day 1)</div>
          <div class="result-value" id="result-start">—</div>
        </div>

        <!-- End Date -->
        <div class="result-card">
          <div class="result-label">End (Final Day)</div>
          <div class="result-value" id="result-end">—</div>
          <div class="result-sub" id="result-end-date">—</div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="progress-section">
        <div class="progress-header">
          <span class="progress-label">Notice Period Progress</span>
          <span class="progress-value" id="progress-percent">0%</span>
        </div>
        <div class="progress-bar-container" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"
          id="progress-bar-wrapper">
          <div class="progress-bar-fill" id="progress-bar" style="width: 0%;"></div>
        </div>
        <div class="progress-meta">
          <div class="meta-item">
            <i class="bi bi-clock" aria-hidden="true"></i>
            <span id="meta-weeks">— weeks</span>
          </div>
          <div class="meta-item">
            <i class="bi bi-calendar-check" aria-hidden="true"></i>
            ETA: <strong id="meta-eta">—</strong>
          </div>
        </div>
      </div>

      <!-- Shareable URL -->
      <div class="url-display" id="url-container" style="display: none;">
        <i class="bi bi-link-45deg" aria-hidden="true"></i>
        <input type="text" id="share-url" readonly aria-label="Shareable URL">
        <button type="button" class="btn-custom btn-secondary btn-icon" id="btn-copy-url"
          aria-label="Copy URL to clipboard">
          <i class="bi bi-clipboard" aria-hidden="true"></i>
        </button>
      </div>
    </section>

    <!-- Empty State -->
    <section class="card-section empty-state-container" id="empty-state" aria-live="polite">
      <div class="empty-state">
        <i class="bi bi-calendar-plus" aria-hidden="true"></i>
        <p>Select a resignation date and click Calculate to see your notice period details</p>
      </div>
    </section>

    <!-- About Section -->
    <section class="card-section" aria-labelledby="about-section-label">
      <div class="section-label" id="about-section-label">
        <i class="bi bi-info-circle" aria-hidden="true"></i>
        About the Calculation
      </div>
      <div class="info-box">
        <i class="bi bi-lightbulb" aria-hidden="true"></i>
        <p>Counting is inclusive (Day 1 = resignation date) and uses date ordinals in the selected timezone to avoid DST
          issues.</p>
      </div>
    </section>

    <!-- Footer -->
    <footer class="app-footer">
      <p>Notice Period Tracker • Timezone-aware calculations</p>
    </footer>
  </main>

  <!-- Toast Container -->
  <div class="toast-container" aria-live="assertive" aria-atomic="true">
    <div class="toast-notification" id="toast" role="alert">
      <i class="bi bi-check-circle" aria-hidden="true"></i>
      <span id="toast-message">Copied to clipboard</span>
    </div>
  </div>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    (function () {
      'use strict';

      // DOM Elements
      const elements = {
        periodToggles: document.querySelectorAll('.period-toggle'),
        resignationDate: document.getElementById('resignation-date'),
        timezoneSelect: document.getElementById('timezone-select'),
        btnCalculate: document.getElementById('btn-calculate'),
        btnIcs: document.getElementById('btn-ics'),
        btnGcal: document.getElementById('btn-gcal'),
        btnShare: document.getElementById('btn-share'),
        btnReset: document.getElementById('btn-reset'),
        btnCopyUrl: document.getElementById('btn-copy-url'),
        resultsContainer: document.querySelector('.results-container'),
        emptyState: document.getElementById('empty-state'),
        urlContainer: document.getElementById('url-container'),
        shareUrl: document.getElementById('share-url'),
        toast: document.getElementById('toast'),
        toastMessage: document.getElementById('toast-message'),
        progressBar: document.getElementById('progress-bar'),
        progressBarWrapper: document.getElementById('progress-bar-wrapper'),
        // Result elements
        resultToday: document.getElementById('result-today'),
        resultTodayDate: document.getElementById('result-today-date'),
        resultDayNumber: document.getElementById('result-day-number'),
        resultCompleted: document.getElementById('result-completed'),
        resultCompletedOf: document.getElementById('result-completed-of'),
        resultRemaining: document.getElementById('result-remaining'),
        resultRemainingSub: document.getElementById('result-remaining-sub'),
        remainingCard: document.getElementById('remaining-card'),
        resultStart: document.getElementById('result-start'),
        resultEnd: document.getElementById('result-end'),
        resultEndDate: document.getElementById('result-end-date'),
        progressPercent: document.getElementById('progress-percent'),
        metaWeeks: document.getElementById('meta-weeks'),
        metaEta: document.getElementById('meta-eta')
      };

      // State
      let state = {
        noticePeriod: 90,
        resignationDate: null,
        timezone: 'Asia/Calcutta',
        calculated: false
      };

      // Initialize timezone dropdown
      function initTimezones() {
        const timezones = Intl.supportedValuesOf('timeZone');
        const userTz = state.timezone;

        timezones.forEach(tz => {
          const option = document.createElement('option');
          option.value = tz;
          option.textContent = tz.replace(/_/g, ' ');
          if (tz === userTz) option.selected = true;
          elements.timezoneSelect.appendChild(option);
        });
      }

      // Parse URL parameters
      function parseUrlParams() {
        const params = new URLSearchParams(window.location.search);

        if (params.has('days')) {
          const days = parseInt(params.get('days'));
          if ([30, 60, 90].includes(days)) {
            state.noticePeriod = days;
            updatePeriodToggle(days);
          }
        }

        if (params.has('date')) {
          const date = params.get('date');
          if (/^\d{4}-\d{2}-\d{2}$/.test(date)) {
            elements.resignationDate.value = date;
            state.resignationDate = date;
          }
        }

        if (params.has('tz')) {
          const tz = params.get('tz');
          if (Intl.supportedValuesOf('timeZone').includes(tz)) {
            state.timezone = tz;
            elements.timezoneSelect.value = tz;
          }
        }

        if (state.resignationDate) {
          calculate();
        }
      }

      // Update period toggle UI
      function updatePeriodToggle(days) {
        elements.periodToggles.forEach(toggle => {
          const isActive = parseInt(toggle.dataset.days) === days;
          toggle.classList.toggle('active', isActive);
          toggle.setAttribute('aria-pressed', isActive);
        });
      }

      // Get date in timezone
      function getDateInTimezone(date, timezone) {
        return new Date(date.toLocaleString('en-US', { timeZone: timezone }));
      }

      // Format date for display
      function formatDate(date, options = {}) {
        const defaultOptions = {
          weekday: 'short',
          month: 'short',
          day: 'numeric',
          timeZone: state.timezone
        };
        return date.toLocaleDateString('en-US', { ...defaultOptions, ...options });
      }

      // Format full date
      function formatFullDate(date) {
        return date.toLocaleDateString('en-US', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          timeZone: state.timezone
        });
      }

      // Calculate days between dates (inclusive)
      function daysBetween(start, end) {
        const startDate = new Date(start.getFullYear(), start.getMonth(), start.getDate());
        const endDate = new Date(end.getFullYear(), end.getMonth(), end.getDate());
        const diffTime = endDate - startDate;
        return Math.floor(diffTime / (1000 * 60 * 60 * 24));
      }

      // Add days to date
      function addDays(date, days) {
        const result = new Date(date);
        result.setDate(result.getDate() + days);
        return result;
      }

      // Calculate notice period
      function calculate() {
        const dateValue = elements.resignationDate.value;
        if (!dateValue) {
          showToast('Please select a resignation date', 'warning');
          return;
        }

        state.resignationDate = dateValue;
        state.calculated = true;

        // Parse resignation date
        const [year, month, day] = dateValue.split('-').map(Number);
        const resignationDate = new Date(year, month - 1, day);

        // Calculate end date (notice period - 1 because day 1 is resignation date)
        const endDate = addDays(resignationDate, state.noticePeriod - 1);

        // Get today in the selected timezone
        const now = new Date();
        const todayStr = now.toLocaleDateString('en-CA', { timeZone: state.timezone });
        const [todayYear, todayMonth, todayDay] = todayStr.split('-').map(Number);
        const today = new Date(todayYear, todayMonth - 1, todayDay);

        // Calculate statistics
        const daysSinceStart = daysBetween(resignationDate, today);
        const currentDay = daysSinceStart + 1; // Inclusive (Day 1 = resignation date)
        const daysCompleted = Math.max(0, Math.min(daysSinceStart, state.noticePeriod));
        const daysRemaining = Math.max(0, state.noticePeriod - daysCompleted);
        const progressPercent = Math.min(100, Math.max(0, (daysCompleted / state.noticePeriod) * 100));
        const weeksRemaining = (daysRemaining / 7).toFixed(1);

        // Update UI
        elements.resultsContainer.classList.remove('hidden');
        elements.emptyState.style.display = 'none';

        // Today
        elements.resultToday.textContent = formatDate(today);
        elements.resultTodayDate.textContent = formatFullDate(today);

        // Day number
        if (currentDay < 1) {
          elements.resultDayNumber.textContent = 'Not Started';
        } else if (currentDay > state.noticePeriod) {
          elements.resultDayNumber.textContent = 'Completed';
        } else {
          elements.resultDayNumber.textContent = `Day ${currentDay}`;
        }

        // Days completed
        elements.resultCompleted.textContent = daysCompleted;
        elements.resultCompletedOf.textContent = `of ${state.noticePeriod}`;

        // Days remaining
        elements.resultRemaining.textContent = daysRemaining;
        if (daysRemaining === 0) {
          elements.resultRemainingSub.textContent = 'Notice period complete!';
          elements.remainingCard.classList.remove('success');
          elements.remainingCard.classList.add('warning');
        } else {
          elements.resultRemainingSub.textContent = daysRemaining === 1 ? 'day left' : 'days left';
          elements.remainingCard.classList.add('success');
          elements.remainingCard.classList.remove('warning');
        }

        // Start date
        elements.resultStart.textContent = formatDate(resignationDate, { year: 'numeric' });

        // End date
        elements.resultEnd.textContent = formatDate(endDate, { year: 'numeric' });
        elements.resultEndDate.textContent = formatFullDate(endDate);

        // Progress bar
        elements.progressBar.style.width = `${progressPercent}%`;
        elements.progressPercent.textContent = `${Math.round(progressPercent)}%`;
        elements.progressBarWrapper.setAttribute('aria-valuenow', Math.round(progressPercent));

        // Meta info
        elements.metaWeeks.textContent = `${weeksRemaining} weeks`;
        elements.metaEta.textContent = formatDate(endDate, { year: 'numeric' });

        // Enable action buttons
        elements.btnIcs.disabled = false;
        elements.btnGcal.disabled = false;
        elements.btnShare.disabled = false;

        // Update URL
        updateShareUrl();
      }

      // Update shareable URL
      function updateShareUrl() {
        const url = new URL(window.location.href.split('?')[0]);
        url.searchParams.set('days', state.noticePeriod);
        url.searchParams.set('date', state.resignationDate);
        url.searchParams.set('tz', state.timezone);

        elements.shareUrl.value = url.toString();
        elements.urlContainer.style.display = 'flex';

        // Update browser URL without reload
        window.history.replaceState({}, '', url.toString());
      }

      // Generate ICS file content
      function generateIcs() {
        if (!state.resignationDate) return null;

        const [year, month, day] = state.resignationDate.split('-').map(Number);
        const resignationDate = new Date(year, month - 1, day);
        const endDate = addDays(resignationDate, state.noticePeriod - 1);

        const formatIcsDate = (date) => {
          return date.toISOString().split('T')[0].replace(/-/g, '');
        };

        const ics = [
          'BEGIN:VCALENDAR',
          'VERSION:2.0',
          'PRODID:-//Notice Period Tracker//EN',
          'BEGIN:VEVENT',
          `DTSTART;VALUE=DATE:${formatIcsDate(resignationDate)}`,
          `DTEND;VALUE=DATE:${formatIcsDate(addDays(endDate, 1))}`,
          `SUMMARY:Notice Period (${state.noticePeriod} days)`,
          `DESCRIPTION:Notice period from ${formatFullDate(resignationDate)} to ${formatFullDate(endDate)}`,
          `UID:${Date.now()}@notice-period-tracker`,
          'END:VEVENT',
          'END:VCALENDAR'
        ].join('\r\n');

        return ics;
      }

      // Copy ICS to clipboard
      async function copyIcs() {
        const ics = generateIcs();
        if (!ics) return;

        try {
          await navigator.clipboard.writeText(ics);
          showToast('ICS copied to clipboard', 'success');
        } catch (err) {
          // Fallback for older browsers
          const textarea = document.createElement('textarea');
          textarea.value = ics;
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand('copy');
          document.body.removeChild(textarea);
          showToast('ICS copied to clipboard', 'success');
        }
      }

      // Open Google Calendar
      function openGoogleCalendar() {
        if (!state.resignationDate) return;

        const [year, month, day] = state.resignationDate.split('-').map(Number);
        const resignationDate = new Date(year, month - 1, day);
        const endDate = addDays(resignationDate, state.noticePeriod - 1);

        const formatGcalDate = (date) => {
          return date.toISOString().split('T')[0].replace(/-/g, '');
        };

        const params = new URLSearchParams({
          action: 'TEMPLATE',
          text: `Notice Period (${state.noticePeriod} days)`,
          dates: `${formatGcalDate(resignationDate)}/${formatGcalDate(addDays(endDate, 1))}`,
          details: `Notice period tracking from resignation date`,
          ctz: state.timezone
        });

        window.open(`https://calendar.google.com/calendar/render?${params.toString()}`, '_blank');
      }

      // Share functionality
      async function share() {
        const url = elements.shareUrl.value;

        if (navigator.share) {
          try {
            await navigator.share({
              title: 'Notice Period Tracker',
              text: `My ${state.noticePeriod}-day notice period calculation`,
              url: url
            });
          } catch (err) {
            if (err.name !== 'AbortError') {
              copyUrl();
            }
          }
        } else {
          copyUrl();
        }
      }

      // Copy URL to clipboard
      async function copyUrl() {
        try {
          await navigator.clipboard.writeText(elements.shareUrl.value);
          showToast('URL copied to clipboard', 'success');
        } catch (err) {
          elements.shareUrl.select();
          document.execCommand('copy');
          showToast('URL copied to clipboard', 'success');
        }
      }

      // Reset form
      function reset() {
        state = {
          noticePeriod: 90,
          resignationDate: null,
          timezone: 'Asia/Calcutta',
          calculated: false
        };

        elements.resignationDate.value = '';
        elements.timezoneSelect.value = state.timezone;
        updatePeriodToggle(90);

        elements.resultsContainer.classList.add('hidden');
        elements.emptyState.style.display = 'block';
        elements.urlContainer.style.display = 'none';

        elements.btnIcs.disabled = true;
        elements.btnGcal.disabled = true;
        elements.btnShare.disabled = true;

        // Clear URL params
        window.history.replaceState({}, '', window.location.pathname);

        showToast('Reset complete', 'success');
      }

      // Show toast notification
      function showToast(message, type = 'success') {
        elements.toastMessage.textContent = message;
        elements.toast.classList.remove('success');
        if (type === 'success') {
          elements.toast.classList.add('success');
          elements.toast.querySelector('i').className = 'bi bi-check-circle';
        } else {
          elements.toast.querySelector('i').className = 'bi bi-exclamation-circle';
        }

        elements.toast.classList.add('show');

        setTimeout(() => {
          elements.toast.classList.remove('show');
        }, 2500);
      }

      // Event Listeners
      function initEventListeners() {
        // Period toggle
        elements.periodToggles.forEach(toggle => {
          toggle.addEventListener('click', () => {
            state.noticePeriod = parseInt(toggle.dataset.days);
            updatePeriodToggle(state.noticePeriod);
            if (state.calculated) calculate();
          });
        });

        // Date input
        elements.resignationDate.addEventListener('change', () => {
          if (state.calculated) calculate();
        });

        // Timezone select
        elements.timezoneSelect.addEventListener('change', () => {
          state.timezone = elements.timezoneSelect.value;
          if (state.calculated) calculate();
        });

        // Buttons
        elements.btnCalculate.addEventListener('click', calculate);
        elements.btnIcs.addEventListener('click', copyIcs);
        elements.btnGcal.addEventListener('click', openGoogleCalendar);
        elements.btnShare.addEventListener('click', share);
        elements.btnReset.addEventListener('click', reset);
        elements.btnCopyUrl.addEventListener('click', copyUrl);

        // Keyboard accessibility for period toggles
        elements.periodToggles.forEach((toggle, index) => {
          toggle.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
              e.preventDefault();
              const direction = e.key === 'ArrowRight' ? 1 : -1;
              const newIndex = (index + direction + 3) % 3;
              elements.periodToggles[newIndex].focus();
              elements.periodToggles[newIndex].click();
            }
          });
        });
      }

      // Initialize
      function init() {
        initTimezones();
        initEventListeners();
        parseUrlParams();

        // Set default date to 17 October 2025
        if (!elements.resignationDate.value) {
          elements.resignationDate.value = '2025-10-17';
        }
      }

      // Run on DOM ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>

</html>